# =============================================================================
# IBC Configuration File for Charter & Stone Capital
# =============================================================================
#
# This file configures IBC Controller for automated IBKR Gateway management.
# Credentials are loaded from /etc/ibkr/credentials.env (not stored here).
#
# Reference: https://github.com/IbcAlpha/IBC/blob/master/resources/config.ini
# =============================================================================

# =============================================================================
# 1. Authentication Settings
# =============================================================================

# Login credentials - loaded from environment variables
# DO NOT hardcode credentials in this file
IbLoginId=
IbPassword=

# Trading mode: 'paper' or 'live'
# Loaded from IBKR_TRADING_MODE environment variable
TradingMode=paper

# Fix credentials (not used for standard Gateway)
FIXLoginId=
FIXPassword=

# =============================================================================
# 2. TWS/Gateway Settings
# =============================================================================

# Accept incoming API connections automatically
# Set to 'accept' for localhost automation, 'reject' for security
AcceptIncomingConnectionAction=accept

# Allow trading without market data subscription (blind trading)
AllowBlindTrading=yes

# Dismiss paper trading account warning automatically
AcceptNonBrokerageAccountWarning=yes

# Existing session handling: take over as primary
ExistingSessionDetectedAction=primary

# Do not minimize Gateway window
MinimizeMainWindow=no

# Do not store settings on server
StoreSettingsOnServer=no

# =============================================================================
# 3. API Settings
# =============================================================================

# Allow read-write API access (required for trading bot)
ReadOnlyLogin=no
ReadOnlyApi=no

# Override API port (optional - Gateway default is 4002)
# OverrideTwsApiPort=4002

# =============================================================================
# 4. Auto-Logoff/Restart Settings
# =============================================================================

# IMPORTANT: These are DISABLED because we use systemd timer for restarts
# Gateway internal restart has issues with memory leak accumulation
# Systemd timer at 4:30 PM ET provides cleaner restart

# Disable Gateway auto-logoff
IbAutoClosedown=no
AutoLogoffTime=

# Disable Gateway auto-restart (managed by systemd)
AutoRestartTime=

# =============================================================================
# 5. Two-Factor Authentication Settings
# =============================================================================

# Exit if 2FA times out (allows systemd to restart cleanly)
ExitAfterSecondFactorAuthenticationTimeout=yes

# 2FA timeout in seconds (IBKR default is 180)
SecondFactorAuthenticationTimeout=180

# Attempt 2FA re-request (allows retry without full restart)
ReloginAfterSecondFactorAuthenticationTimeout=yes

# =============================================================================
# 6. Command Server Settings
# =============================================================================

# Disable IBC command server (we use systemd for management)
# Setting to 0 disables the command server entirely
CommandServerPort=0

# If command server were enabled, restrict to localhost
BindAddress=127.0.0.1
ControlFrom=127.0.0.1

# =============================================================================
# 7. Logging Settings
# =============================================================================

# IBC creates its own log file in the IBC installation directory
# Additional Gateway logs are captured by systemd journal

# =============================================================================
# END OF CONFIGURATION
# =============================================================================
